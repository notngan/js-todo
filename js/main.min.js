!function o(i,a,l){function s(t,e){if(!a[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(d)return d(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var c=a[t]={exports:{}};i[t][0].call(c.exports,function(e){return s(i[t][1][e]||e)},c,c.exports,o,i,a,l)}return a[t].exports}for(var d="function"==typeof require&&require,e=0;e<l.length;e++)s(l[e]);return s}({1:[function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var l=[],c=document.querySelector(".new-input"),o=document.querySelector(".btn-active"),i=document.querySelector(".btn-all"),a=document.querySelector(".btn-complete"),s=document.querySelector(".bottom-wrap"),d=document.querySelector(".todo-list"),u=document.querySelector(".complete-all"),f='<div class="todo-item %complete% %hide%">\n  <input class="complete-btn" type="checkbox" %check%></input>\n  <input type="text" class="content" value="%value%" disabled></input>\n  <span class="delete-btn">×</span>\n  </div>';function m(e){13===e.keyCode&&""!==c.value&&(f=f.replace(/%value%/,c.value),document.addEventListener("click",function(e){q(e.target,"complete-btn")?h(e.target):q(e.target,"delete-btn")&&p(e.target)}),document.addEventListener("dblclick",function(e){q(e.target,"content")&&v(e.target)}),a.classList.contains("active")&&(f=f.replace(/%hide%/,"hide")),d.insertAdjacentHTML("beforeend",f),A(),l.push({text:c.value,isCompleted:!1}),E(),c.value="",s.classList.remove("hide"),S())}function p(e){var t=document.querySelectorAll(".todo-item"),n=e.parentElement,r=n.parentElement;if(r&&n){var c=Array.prototype.indexOf.call(r.childNodes,n);for(var o in l)if(c==o){l.splice(o,1),E();break}r.removeChild(n),A(),t.length<2&&s.classList.add("hide")}}function v(i){var a=document.querySelectorAll(".todo-item");i.disabled=!1,i.addEventListener("keydown",function(e){if(13===e.keyCode){var t=i.parentElement,n=t.parentElement;if(null!=n&&null!=t){var r=Array.prototype.indexOf.call(n.childNodes,t);if(""==i.value){for(var c in l)if(r==c){l.splice(c,1),E();break}return n.removeChild(t),A(),void(a.length<2&&s.classList.add("hide"))}for(var o in l)if(o==r){l[o].text=this.value,E();break}}}})}function h(e){var t=e.parentElement,n=Array.prototype.indexOf.call(d.childNodes,t);if(e.checked){for(var r in t.classList.add("complete"),o.classList.contains("active")&&t.classList.add("hide"),A(),l)if(n==r){l[r].isCompleted=!0,E();break}}else for(var c in t.classList.remove("complete"),a.classList.contains("active")&&t.classList.add("hide"),A(),l)if(n==c){l[c].isCompleted=!1,E();break}}function y(){var r=document.querySelectorAll(".todo-item"),c=0;Array.from(r).forEach(function(e){var t=Array.prototype.indexOf.call(d.childNodes,e);if(e.classList.contains("complete"))c++;else for(var n in e.classList.add("complete"),e.querySelector(".complete-btn").checked=!0,A(),o.classList.contains("active")&&e.classList.add("hide"),a.classList.contains("active")&&e.classList.remove("hide"),l)if(t==n){l[n].isCompleted=!0,E();break}c===r.length&&Array.from(r).forEach(function(e){e.classList.remove("complete"),e.querySelector(".complete-btn").checked=!1;var t=Array.prototype.indexOf.call(d.childNodes,e);for(var n in A(),a.classList.contains("active")&&e.classList.add("hide"),o.classList.contains("active")&&e.classList.remove("hide"),l)if(t==n){l[n].isCompleted=!1,E();break}})})}function L(){var e=document.querySelectorAll(".todo-item");console.log("active"),Array.from(e).forEach(function(e){e.classList.contains("complete")?e.classList.add("hide"):e.classList.remove("hide")}),k(this)}function b(){var e=document.querySelectorAll(".todo-item");Array.from(e).forEach(function(e){e.classList.contains("complete")?e.classList.remove("hide"):e.classList.add("hide")}),k(this)}function g(){var e=document.querySelectorAll(".todo-item");Array.from(e).forEach(function(e){e.classList.remove("hide")}),k(this)}function k(e){var t=document.querySelectorAll(".btn");Array.from(t).forEach(function(e){e.classList.remove("active")}),e.classList.add("active")}function A(){var e=document.querySelectorAll(".todo-item:not(.complete");document.querySelector(".item-count").innerHTML=e.length||0}function E(){localStorage.clear(),localStorage.setItem("list",JSON.stringify(l))}function S(){f='<div class="todo-item %complete% %hide%">\n  <input class="complete-btn" type="checkbox" %check%></input>\n  <input type="text" class="content" value="%value%" disabled></input>\n  <span class="delete-btn">×</span>\n  </div>'}function q(e,t){return-1<e.className.split(" ").indexOf(t)}window.addEventListener("DOMContentLoaded",function(){!function(){var e=JSON.parse(localStorage.getItem("list"))||[];if(l.push.apply(l,r(e)),!e||e.length<1)return;for(var t=0;t<e.length;t++)f=f.replace(/%value%/,e[t].text),document.addEventListener("click",function(e){q(e.target,"complete-btn")?h(e.target):q(e.target,"delete-btn")&&p(e.target)}),document.addEventListener("dblclick",function(e){q(e.target,"content")&&v(e.target)}),e[t].isCompleted&&(f=(f=f.replace(/%check%/,"checked")).replace(/%complete%/,"complete")),d.insertAdjacentHTML("beforeend",f),s.classList.remove("hide"),A(),S()}(),c.addEventListener("keydown",m),o.addEventListener("click",L),a.addEventListener("click",b),i.addEventListener("click",g),u.addEventListener("click",y)})},{}]},{},[1]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4ubWluLmpzIl0sIm5hbWVzIjpbInIiLCJlIiwibiIsInQiLCJvIiwiaSIsImYiLCJjIiwicmVxdWlyZSIsInUiLCJhIiwiRXJyb3IiLCJjb2RlIiwicCIsImV4cG9ydHMiLCJjYWxsIiwibGVuZ3RoIiwiMSIsIm1vZHVsZSIsIl90b0NvbnN1bWFibGVBcnJheSIsImFyciIsIkFycmF5IiwiaXNBcnJheSIsImFycjIiLCJfYXJyYXlXaXRob3V0SG9sZXMiLCJpdGVyIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJ0b1N0cmluZyIsImZyb20iLCJfaXRlcmFibGVUb0FycmF5IiwiVHlwZUVycm9yIiwiX25vbkl0ZXJhYmxlU3ByZWFkIiwiY29udGVudEFyciIsImlucHV0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYnRuQWN0aXZlIiwiYnRuQWxsIiwiYnRuQ29tcGxldGUiLCJib3R0b20iLCJsaXN0IiwiYnRuQ29tcGxldGVBbGwiLCJpdGVtIiwiYWRkVG9kbyIsImtleUNvZGUiLCJ2YWx1ZSIsInJlcGxhY2UiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFzQ2xhc3MiLCJ0YXJnZXQiLCJjb21wbGV0ZVRvZG8iLCJkZWxldGVUb2RvIiwiZWRpdFRvZG8iLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImluc2VydEFkamFjZW50SFRNTCIsImNvdW50QWN0aXZlIiwicHVzaCIsInRleHQiLCJpc0NvbXBsZXRlZCIsInJlc2V0U3RvcmFnZSIsInJlbW92ZSIsInJlc2V0U3RyaW5nIiwiZGVsZXRlQnRuIiwidG9kb0l0ZW1zIiwicXVlcnlTZWxlY3RvckFsbCIsInBhcmVudEVsZW1lbnQiLCJpbmRleCIsImluZGV4T2YiLCJjaGlsZE5vZGVzIiwia2V5Iiwic3BsaWNlIiwicmVtb3ZlQ2hpbGQiLCJhZGQiLCJjb250ZW50IiwiZGlzYWJsZWQiLCJfa2V5IiwidGhpcyIsImNoZWNrYm94IiwiY2hlY2tlZCIsIl9rZXkyIiwiY29tcGxldGVBbGwiLCJhbGxJdGVtcyIsImNvbXBsZXRlZCIsImZvckVhY2giLCJlbCIsIl9rZXkzIiwic2hvd0FjdGl2ZSIsImNvbnNvbGUiLCJsb2ciLCJhZGRCdXR0b25TdHlsZSIsInNob3dDb21wbGV0ZSIsInNob3dBbGwiLCJlbGVtZW50IiwiYnRucyIsImFjdGl2ZXMiLCJpbm5lckhUTUwiLCJsb2NhbFN0b3JhZ2UiLCJjbGVhciIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiY2xhc3NOYW1lIiwic3BsaXQiLCJ3aW5kb3ciLCJzdG9yZSIsInBhcnNlIiwiZ2V0SXRlbSIsImFwcGx5IiwiZGlzcGxheVN0b3JhZ2UiXSwibWFwcGluZ3MiOiJDQUFZLFNBQVNBLEVBQUVDLEVBQUVDLEVBQUVDLEdBQUcsU0FBU0MsRUFBRUMsRUFBRUMsR0FBRyxJQUFJSixFQUFFRyxHQUFHLENBQUMsSUFBSUosRUFBRUksR0FBRyxDQUFDLElBQUlFLEVBQUUsbUJBQW1CQyxTQUFTQSxRQUFRLElBQUlGLEdBQUdDLEVBQUUsT0FBT0EsRUFBRUYsR0FBRSxHQUFJLEdBQUdJLEVBQUUsT0FBT0EsRUFBRUosR0FBRSxHQUFJLElBQUlLLEVBQUUsSUFBSUMsTUFBTSx1QkFBdUJOLEVBQUUsS0FBSyxNQUFNSyxFQUFFRSxLQUFLLG1CQUFtQkYsRUFBRSxJQUFJRyxFQUFFWCxFQUFFRyxHQUFHLENBQUNTLFFBQVEsSUFBSWIsRUFBRUksR0FBRyxHQUFHVSxLQUFLRixFQUFFQyxRQUFRLFNBQVNkLEdBQW9CLE9BQU9JLEVBQWxCSCxFQUFFSSxHQUFHLEdBQUdMLElBQWVBLElBQUlhLEVBQUVBLEVBQUVDLFFBQVFkLEVBQUVDLEVBQUVDLEVBQUVDLEdBQUcsT0FBT0QsRUFBRUcsR0FBR1MsUUFBUSxJQUFJLElBQUlMLEVBQUUsbUJBQW1CRCxTQUFTQSxRQUFRSCxFQUFFLEVBQUVBLEVBQUVGLEVBQUVhLE9BQU9YLElBQUlELEVBQUVELEVBQUVFLElBQUksT0FBT0QsRUFBN2IsQ0FBNGMsQ0FBQ2EsRUFBRSxDQUFD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QUFpQixXQUFZLFNBQVVqRCxHQUMxQ2tELEVBQVNsRCxFQUFFbUQsT0FBUSxZQUNyQkcsRUFBU3RELEVBQUVtRCxVQUlYd0QsRUFBTXZHLEdBQUd5RCxjQUVYakIsR0FEQUEsRUFBT0EsRUFBS0ksUUFBUSxVQUFXLFlBQ25CQSxRQUFRLGFBQWMsYUFHcENOLEVBQUtlLG1CQUFtQixZQUFhYixHQUNyQ0gsRUFBT2MsVUFBVVEsT0FBTyxRQUN4QkwsSUFDQU0sSUE1RUYrQyxHQUNBNUUsRUFBTWMsaUJBQWlCLFVBQVdKLEdBQ2xDUCxFQUFVVyxpQkFBaUIsUUFBU3dDLEdBQ3BDakQsRUFBWVMsaUJBQWlCLFFBQVM0QyxHQUN0Q3RELEVBQU9VLGlCQUFpQixRQUFTNkMsR0FDakNuRCxFQUFlTSxpQkFBaUIsUUFBU2tDLE1BNlN6QyxLQUFLLEdBQUcsQ0FBQyIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsgfVxuXG5mdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZVwiKTsgfVxuXG5mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSBcIltvYmplY3QgQXJndW1lbnRzXVwiKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfVxuXG5mdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9XG5cbnZhciBjb250ZW50QXJyID0gW107XG52YXIgaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3LWlucHV0Jyk7XG52YXIgYnRuQWN0aXZlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ0bi1hY3RpdmUnKTtcbnZhciBidG5BbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnRuLWFsbCcpO1xudmFyIGJ0bkNvbXBsZXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ0bi1jb21wbGV0ZScpO1xudmFyIGJvdHRvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib3R0b20td3JhcCcpO1xudmFyIGxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudG9kby1saXN0Jyk7XG52YXIgYnRuQ29tcGxldGVBbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29tcGxldGUtYWxsJyk7XG52YXIgaXRlbSA9IFwiPGRpdiBjbGFzcz1cXFwidG9kby1pdGVtICVjb21wbGV0ZSUgJWhpZGUlXFxcIj5cXG4gIDxpbnB1dCBjbGFzcz1cXFwiY29tcGxldGUtYnRuXFxcIiB0eXBlPVxcXCJjaGVja2JveFxcXCIgJWNoZWNrJT48L2lucHV0PlxcbiAgPGlucHV0IHR5cGU9XFxcInRleHRcXFwiIGNsYXNzPVxcXCJjb250ZW50XFxcIiB2YWx1ZT1cXFwiJXZhbHVlJVxcXCIgZGlzYWJsZWQ+PC9pbnB1dD5cXG4gIDxzcGFuIGNsYXNzPVxcXCJkZWxldGUtYnRuXFxcIj5cXHhENzwvc3Bhbj5cXG4gIDwvZGl2PlwiO1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoKSB7XG4gIGRpc3BsYXlTdG9yYWdlKCk7XG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBhZGRUb2RvKTtcbiAgYnRuQWN0aXZlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2hvd0FjdGl2ZSk7XG4gIGJ0bkNvbXBsZXRlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2hvd0NvbXBsZXRlKTtcbiAgYnRuQWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2hvd0FsbCk7XG4gIGJ0bkNvbXBsZXRlQWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29tcGxldGVBbGwpO1xufSk7IC8vRlVOQ1RJT05TXG5cbmZ1bmN0aW9uIGFkZFRvZG8oZSkge1xuICAvL3JldHVybiBpZiBub3Qga2V5IEVudGVyXG4gIGlmIChlLmtleUNvZGUgIT09IDEzKSByZXR1cm47XG5cbiAgaWYgKGlucHV0LnZhbHVlICE9PSAnJykge1xuICAgIGl0ZW0gPSBpdGVtLnJlcGxhY2UoLyV2YWx1ZSUvLCBpbnB1dC52YWx1ZSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGhhc0NsYXNzKGUudGFyZ2V0LCAnY29tcGxldGUtYnRuJykpIHtcbiAgICAgICAgY29tcGxldGVUb2RvKGUudGFyZ2V0KTtcbiAgICAgIH0gZWxzZSBpZiAoaGFzQ2xhc3MoZS50YXJnZXQsICdkZWxldGUtYnRuJykpIHtcbiAgICAgICAgZGVsZXRlVG9kbyhlLnRhcmdldCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZGJsY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGhhc0NsYXNzKGUudGFyZ2V0LCAnY29udGVudCcpKSB7XG4gICAgICAgIGVkaXRUb2RvKGUudGFyZ2V0KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChidG5Db21wbGV0ZS5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XG4gICAgICBpdGVtID0gaXRlbS5yZXBsYWNlKC8laGlkZSUvLCAnaGlkZScpO1xuICAgIH1cblxuICAgIGxpc3QuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBpdGVtKTtcbiAgICBjb3VudEFjdGl2ZSgpOyAvLyBzYXZlIHRvIHN0b3JhZ2VcblxuICAgIGNvbnRlbnRBcnIucHVzaCh7XG4gICAgICB0ZXh0OiBpbnB1dC52YWx1ZSxcbiAgICAgIGlzQ29tcGxldGVkOiBmYWxzZVxuICAgIH0pO1xuICAgIHJlc2V0U3RvcmFnZSgpOyAvLyByZXNldCBpbnB1dFxuXG4gICAgaW5wdXQudmFsdWUgPSAnJzsgLy9zaG93IGJvdHRvbVxuXG4gICAgYm90dG9tLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICByZXNldFN0cmluZygpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGRpc3BsYXlTdG9yYWdlKCkge1xuICB2YXIgc3RvcmUgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsaXN0JykpIHx8IFtdO1xuICBjb250ZW50QXJyLnB1c2guYXBwbHkoY29udGVudEFyciwgX3RvQ29uc3VtYWJsZUFycmF5KHN0b3JlKSk7XG4gIGlmICghc3RvcmUgfHwgc3RvcmUubGVuZ3RoIDwgMSkgcmV0dXJuO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3RvcmUubGVuZ3RoOyBpKyspIHtcbiAgICBpdGVtID0gaXRlbS5yZXBsYWNlKC8ldmFsdWUlLywgc3RvcmVbaV0udGV4dCk7IC8vIGFkZCBjb21wbGV0ZWQgc3R5bGVcblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChoYXNDbGFzcyhlLnRhcmdldCwgJ2NvbXBsZXRlLWJ0bicpKSB7XG4gICAgICAgIGNvbXBsZXRlVG9kbyhlLnRhcmdldCk7XG4gICAgICB9IGVsc2UgaWYgKGhhc0NsYXNzKGUudGFyZ2V0LCAnZGVsZXRlLWJ0bicpKSB7XG4gICAgICAgIGRlbGV0ZVRvZG8oZS50YXJnZXQpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RibGNsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChoYXNDbGFzcyhlLnRhcmdldCwgJ2NvbnRlbnQnKSkge1xuICAgICAgICBlZGl0VG9kbyhlLnRhcmdldCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoc3RvcmVbaV0uaXNDb21wbGV0ZWQpIHtcbiAgICAgIGl0ZW0gPSBpdGVtLnJlcGxhY2UoLyVjaGVjayUvLCAnY2hlY2tlZCcpO1xuICAgICAgaXRlbSA9IGl0ZW0ucmVwbGFjZSgvJWNvbXBsZXRlJS8sICdjb21wbGV0ZScpO1xuICAgIH1cblxuICAgIGxpc3QuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBpdGVtKTtcbiAgICBib3R0b20uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgIGNvdW50QWN0aXZlKCk7XG4gICAgcmVzZXRTdHJpbmcoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBkZWxldGVUb2RvKGRlbGV0ZUJ0bikge1xuICB2YXIgdG9kb0l0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRvZG8taXRlbScpO1xuICB2YXIgaXRlbSA9IGRlbGV0ZUJ0bi5wYXJlbnRFbGVtZW50O1xuICB2YXIgbGlzdCA9IGl0ZW0ucGFyZW50RWxlbWVudDtcbiAgaWYgKCFsaXN0IHx8ICFpdGVtKSByZXR1cm47XG4gIHZhciBpbmRleCA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwobGlzdC5jaGlsZE5vZGVzLCBpdGVtKTtcblxuICBmb3IgKHZhciBrZXkgaW4gY29udGVudEFycikge1xuICAgIGlmIChpbmRleCA9PSBrZXkpIHtcbiAgICAgIGNvbnRlbnRBcnIuc3BsaWNlKGtleSwgMSk7XG4gICAgICByZXNldFN0b3JhZ2UoKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGxpc3QucmVtb3ZlQ2hpbGQoaXRlbSk7XG4gIGNvdW50QWN0aXZlKCk7XG5cbiAgaWYgKHRvZG9JdGVtcy5sZW5ndGggPCAyKSB7XG4gICAgYm90dG9tLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBlZGl0VG9kbyhjb250ZW50KSB7XG4gIHZhciB0b2RvSXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9kby1pdGVtJyk7XG4gIGNvbnRlbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgY29udGVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS5rZXlDb2RlICE9PSAxMykgcmV0dXJuO1xuICAgIHZhciBpdGVtID0gY29udGVudC5wYXJlbnRFbGVtZW50O1xuICAgIHZhciBsaXN0ID0gaXRlbS5wYXJlbnRFbGVtZW50O1xuICAgIGlmIChsaXN0ID09IG51bGwgfHwgaXRlbSA9PSBudWxsKSByZXR1cm47XG4gICAgdmFyIGluZGV4ID0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChsaXN0LmNoaWxkTm9kZXMsIGl0ZW0pOyAvLyBpZiBjb250ZW50IGVtcHR5XG5cbiAgICBpZiAoY29udGVudC52YWx1ZSA9PSAnJykge1xuICAgICAgZm9yICh2YXIga2V5IGluIGNvbnRlbnRBcnIpIHtcbiAgICAgICAgaWYgKGluZGV4ID09IGtleSkge1xuICAgICAgICAgIGNvbnRlbnRBcnIuc3BsaWNlKGtleSwgMSk7XG4gICAgICAgICAgcmVzZXRTdG9yYWdlKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbGlzdC5yZW1vdmVDaGlsZChpdGVtKTtcbiAgICAgIGNvdW50QWN0aXZlKCk7XG5cbiAgICAgIGlmICh0b2RvSXRlbXMubGVuZ3RoIDwgMikge1xuICAgICAgICBib3R0b20uY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgO1xuXG4gICAgZm9yICh2YXIgX2tleSBpbiBjb250ZW50QXJyKSB7XG4gICAgICBpZiAoX2tleSA9PSBpbmRleCkge1xuICAgICAgICBjb250ZW50QXJyW19rZXldLnRleHQgPSB0aGlzLnZhbHVlO1xuICAgICAgICByZXNldFN0b3JhZ2UoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gY29tcGxldGVUb2RvKGNoZWNrYm94KSB7XG4gIHZhciBpdGVtID0gY2hlY2tib3gucGFyZW50RWxlbWVudDtcbiAgdmFyIGluZGV4ID0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChsaXN0LmNoaWxkTm9kZXMsIGl0ZW0pOyAvLyBpdGVtIGlzIGNvbXBsZXRlZFxuXG4gIGlmIChjaGVja2JveC5jaGVja2VkKSB7XG4gICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZScpO1xuXG4gICAgaWYgKGJ0bkFjdGl2ZS5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XG4gICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICB9XG5cbiAgICBjb3VudEFjdGl2ZSgpO1xuXG4gICAgZm9yICh2YXIga2V5IGluIGNvbnRlbnRBcnIpIHtcbiAgICAgIGlmIChpbmRleCA9PSBrZXkpIHtcbiAgICAgICAgY29udGVudEFycltrZXldLmlzQ29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgcmVzZXRTdG9yYWdlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBpdGVtIGlzIGFjdGl2ZVxuICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnY29tcGxldGUnKTtcblxuICAgIGlmIChidG5Db21wbGV0ZS5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XG4gICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICB9XG5cbiAgICBjb3VudEFjdGl2ZSgpO1xuXG4gICAgZm9yICh2YXIgX2tleTIgaW4gY29udGVudEFycikge1xuICAgICAgaWYgKGluZGV4ID09IF9rZXkyKSB7XG4gICAgICAgIGNvbnRlbnRBcnJbX2tleTJdLmlzQ29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgIHJlc2V0U3RvcmFnZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gY29tcGxldGVBbGwoKSB7XG4gIHZhciBhbGxJdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50b2RvLWl0ZW0nKTtcbiAgdmFyIGNvbXBsZXRlZCA9IDA7XG4gIEFycmF5LmZyb20oYWxsSXRlbXMpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICB2YXIgaW5kZXggPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGxpc3QuY2hpbGROb2RlcywgaXRlbSk7XG5cbiAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbXBsZXRlJykpIHtcbiAgICAgIGNvbXBsZXRlZCsrO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBpdGVtIGlzIHVuY29tcGxldGVkXG4gICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2NvbXBsZXRlJyk7XG4gICAgICBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5jb21wbGV0ZS1idG4nKS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgIGNvdW50QWN0aXZlKCk7XG5cbiAgICAgIGlmIChidG5BY3RpdmUuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGJ0bkNvbXBsZXRlLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGtleSBpbiBjb250ZW50QXJyKSB7XG4gICAgICAgIGlmIChpbmRleCA9PSBrZXkpIHtcbiAgICAgICAgICBjb250ZW50QXJyW2tleV0uaXNDb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgIHJlc2V0U3RvcmFnZSgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNvbXBsZXRlZCA9PT0gYWxsSXRlbXMubGVuZ3RoKSB7XG4gICAgICAvLyBhbGwgaXRlbXMgYXJlIGNvbXBsZXRlZFxuICAgICAgQXJyYXkuZnJvbShhbGxJdGVtcykuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnY29tcGxldGUnKTtcbiAgICAgICAgZWwucXVlcnlTZWxlY3RvcignLmNvbXBsZXRlLWJ0bicpLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgdmFyIGluZGV4ID0gQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChsaXN0LmNoaWxkTm9kZXMsIGVsKTtcbiAgICAgICAgY291bnRBY3RpdmUoKTtcblxuICAgICAgICBpZiAoYnRuQ29tcGxldGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkge1xuICAgICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChidG5BY3RpdmUuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkge1xuICAgICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgICAgfSAvLyBzYXZlIHRvIHN0b3JhZ2VcblxuXG4gICAgICAgIGZvciAodmFyIF9rZXkzIGluIGNvbnRlbnRBcnIpIHtcbiAgICAgICAgICBpZiAoaW5kZXggPT0gX2tleTMpIHtcbiAgICAgICAgICAgIGNvbnRlbnRBcnJbX2tleTNdLmlzQ29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgICAgICByZXNldFN0b3JhZ2UoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gc2hvd0FjdGl2ZSgpIHtcbiAgdmFyIGFsbEl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRvZG8taXRlbScpO1xuICBjb25zb2xlLmxvZygnYWN0aXZlJyk7XG4gIEFycmF5LmZyb20oYWxsSXRlbXMpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpZiAoIWl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdjb21wbGV0ZScpKSB7XG4gICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgfVxuICB9KTtcbiAgYWRkQnV0dG9uU3R5bGUodGhpcyk7XG59XG5cbmZ1bmN0aW9uIHNob3dDb21wbGV0ZSgpIHtcbiAgLy9jb25zdCBhY3RpdmVJdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50b2RvLWl0ZW06bm90KC5jb21wbGV0ZSknKTtcbiAgLy9jb25zdCBjb21wbGV0ZUl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbXBsZXRlJyk7XG4gIHZhciBhbGxJdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50b2RvLWl0ZW0nKTtcbiAgQXJyYXkuZnJvbShhbGxJdGVtcykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGlmIChpdGVtLmNsYXNzTGlzdC5jb250YWlucygnY29tcGxldGUnKSkge1xuICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgIH1cbiAgfSk7XG4gIGFkZEJ1dHRvblN0eWxlKHRoaXMpO1xufVxuXG5mdW5jdGlvbiBzaG93QWxsKCkge1xuICB2YXIgYWxsSXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9kby1pdGVtJyk7XG4gIEFycmF5LmZyb20oYWxsSXRlbXMpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgfSk7XG4gIGFkZEJ1dHRvblN0eWxlKHRoaXMpO1xufVxuXG5mdW5jdGlvbiBhZGRCdXR0b25TdHlsZShlbGVtZW50KSB7XG4gIHZhciBidG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJ0bicpO1xuICBBcnJheS5mcm9tKGJ0bnMpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICB9KTtcbiAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbn1cblxuZnVuY3Rpb24gY291bnRBY3RpdmUoKSB7XG4gIHZhciBhY3RpdmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRvZG8taXRlbTpub3QoLmNvbXBsZXRlJyk7XG4gIHZhciBjb3VudERpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaXRlbS1jb3VudCcpO1xuICBjb3VudERpc3BsYXkuaW5uZXJIVE1MID0gYWN0aXZlcy5sZW5ndGggfHwgMDtcbn1cblxuZnVuY3Rpb24gcmVzZXRTdG9yYWdlKCkge1xuICBsb2NhbFN0b3JhZ2UuY2xlYXIoKTtcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2xpc3QnLCBKU09OLnN0cmluZ2lmeShjb250ZW50QXJyKSk7XG59XG5cbmZ1bmN0aW9uIHJlc2V0U3RyaW5nKCkge1xuICBpdGVtID0gXCI8ZGl2IGNsYXNzPVxcXCJ0b2RvLWl0ZW0gJWNvbXBsZXRlJSAlaGlkZSVcXFwiPlxcbiAgPGlucHV0IGNsYXNzPVxcXCJjb21wbGV0ZS1idG5cXFwiIHR5cGU9XFxcImNoZWNrYm94XFxcIiAlY2hlY2slPjwvaW5wdXQ+XFxuICA8aW5wdXQgdHlwZT1cXFwidGV4dFxcXCIgY2xhc3M9XFxcImNvbnRlbnRcXFwiIHZhbHVlPVxcXCIldmFsdWUlXFxcIiBkaXNhYmxlZD48L2lucHV0PlxcbiAgPHNwYW4gY2xhc3M9XFxcImRlbGV0ZS1idG5cXFwiPlxceEQ3PC9zcGFuPlxcbiAgPC9kaXY+XCI7XG59XG5cbmZ1bmN0aW9uIGhhc0NsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xuICByZXR1cm4gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoJyAnKS5pbmRleE9mKGNsYXNzTmFtZSkgPiAtMTtcbn1cblxufSx7fV19LHt9LFsxXSk7XG4iXX0=
